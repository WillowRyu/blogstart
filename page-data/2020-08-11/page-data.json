{"componentChunkName":"component---src-templates-blog-post-js","path":"/2020-08-11/","result":{"data":{"site":{"siteMetadata":{"title":"FE Factory"}},"markdownRemark":{"id":"565e9369-d55d-50fd-8c92-a009bc01b701","excerpt":"밀린 글들이 많은데 시간이 없어서 못 올리는중 🤔 web 개발에서 온 사람들은 flutter 를 이용해 실제 제품 개발 시 ‘그러고보니 환경변수는 어떻게 설정하지?’ 라는 의문이 들었을 것 이다. 아마 대부분 react 를 사용 했을텐데, .env…","html":"<p>밀린 글들이 많은데 시간이 없어서 못 올리는중 🤔</p>\n<p>web 개발에서 온 사람들은 flutter 를 이용해 실제 제품 개발 시<br>\n‘그러고보니 환경변수는 어떻게 설정하지?’<br>\n라는 의문이 들었을 것 이다.</p>\n<p>아마 대부분 react 를 사용 했을텐데, .env 파일로 통일 시켜서<br>\n간편하게(?) 설정을 해왔을 텐데 (이는 angular 도 마찬가지다)<br>\nflutter 에선 어떻게 설정해야 할까?</p>\n<p>공식 홈페이지에 친절하게 설정하는 법이 있다면 좋겠지만<br>\n아쉽게도 친절한 가이드는 없다.  </p>\n<p>그래서 실제 개발 시 사용했던 방법을 공유하고자 한다.<br>\n사실 이 방법도 구글링으로 어디선가 에서 보고 적용한 부분인데<br>\n해당 글이 어딨는지 기억이 나지 않아 출처를 적을 수가 없다..<br>\n만약 기억난다면 그때 출처를 적용하겠다.  </p>\n<p>환경변수는 여러가지 용도로 사용되지만 가장 많이 쓰이는 부분이<br>\n아무래도 API Endpoint 를 개발 환경 별로 적용할 때 많이 쓸 것 이다.  </p>\n<p>이번글은 기존 web 개발과 깉은 순서로 앱이 구동되기 전<br>\n환경별 변수를 적용시켜 앱 내에서 사용해보자.</p>\n<h3>Init Project</h3>\n<p>내가 적는 모든 글은 이전 글과 이어지지 않고, 기존 repo 를 가져와<br>\n사용하지 않으며 독립적으로 무조건 새로운 프로젝트에서 시작할 것 이다.</p>\n<p>새로운 프로젝트를 만들어 main 부분을 정리하자.  </p>\n<h3>Create EnvSetting Class</h3>\n<p>env 셋팅에서 우리는 2개의 클래스를 만들 것 이다.\n실제 앱 환경에서 가져와서 사용 할 클래스, 그리고 환경 변수를 환경에 맞게 설정 해주는 할 클래스 이다.  </p>\n<p>먼저 환경 별 선택을 위한 열거형을 하나 만들자.</p>\n<blockquote>\n<p><code class=\"language-text\">/lib/core/env.dart</code></p>\n</blockquote>\n<deckgo-highlight-code language=\"javascript\"  >\n          <code slot=\"code\"> enum Environment { DEV, STAGING, PROD }</code>\n        </deckgo-highlight-code>\n<p>스테이징, 개발, 제품 버전의 환경을 만들 것 이다.<br>\n필요하다면 당연히 저기서 늘려도 된다.  </p>\n<p>이제 실제로 환경 변수를 설정 하는 클래스를 만들자.</p>\n<blockquote>\n<p><code class=\"language-text\">/lib/core/env.dart</code></p>\n</blockquote>\n<deckgo-highlight-code language=\"javascript\"  >\n          <code slot=\"code\">  ...\n  class _Config {\n    static const AUTH_URL = &#39;AUTH&#39;;\n    static const PRODUCT_URL = &#39;PRODUCT&#39;;\n    static const WEBSOCKET_URL = &#39;WEBSOCKET&#39;;\n\n    static const String devPrefix = &#39;https://dev.cloud&#39;;\n    static const String productPrefix = &#39;https://product.cloud&#39;;\n  }</code>\n        </deckgo-highlight-code>\n<p>일단 예제로 사용 할 URL 은 3가지 인데 당연히 알아서 잘 늘려 사용할 것 으로 본다.<br>\nprefix 같은 경우 공통적으로 쓰는 endpoint 의 앞 부분이다.  </p>\n<p>이제 환경 별로 URL 을 넣어보자.  </p>\n<deckgo-highlight-code language=\"javascript\"  >\n          <code slot=\"code\">  class _Config {\n    ...\n\n    static Map&lt;String, String&gt; debugConstants = {\n      AUTH_URL: &#39;$devPrefix/auth/v1&#39;,\n      PRODUCT_URL: &#39;$devPrefix/product/v1&#39;,\n      WEBSOCKET_URL: &#39;$devPrefix&#39;,\n    }\n\n    static Map&lt;String, String&gt; productConstants = {\n      AUTH_URL: &#39;$productPrefix/auth/v1&#39;,\n      PRODUCT_URL: &#39;$productPrefix/product/v1&#39;,\n      WEBSOCKET_URL: &#39;$productPrefix&#39;,\n    };\n\n    static Map&lt;String, String&gt; stagingConstants = {\n      AUTH_URL: &#39;$productPrefix/auth/v1&#39;,\n      PRODUCT_URL: &#39;$productPrefix/product/v1&#39;,\n      WEBSOCKET_URL: &#39;$productPrefix&#39;,\n    };\n  }</code>\n        </deckgo-highlight-code>\n<p>debug, prod, staging 마다 각 변수에 맞는 url 을 대입한다.<br>\n간단하지 않은가?<br>\n저기서 늘리든 줄이든 커스텀하게 바꾸든 필요에 따라 변경하면 된다.  </p>\n<p>환경 별 값을 설정하는 클래스는 완성되었다.<br>\n이제 현재 어떠한 환경인지 파악해 위 _Config 클래스에서 해당 환경에 맞는<br>\n값을 가져오는 클래스를 만들어야 한다.<br>\n이 역시 간단하다.  </p>\n<p>새로운 클래스를 만들자.  </p>\n<h3>Create Environments Class</h3>\n<blockquote>\n<p><code class=\"language-text\">/lib/core/env.dart</code></p>\n</blockquote>\n<deckgo-highlight-code language=\"javascript\"  >\n          <code slot=\"code\">class Environments {\n  static Map&lt;String, dynamic&gt; _config;\n  static Environment _currentEnv;\n}</code>\n        </deckgo-highlight-code>\n<p>_config 에서는 설정한 환경변수 값을 넣고, _currentEnv 에는 현재 설정한<br>\n환경 값을 넣을 것 이다.  </p>\n<p>이제 환경변수를 받아 설정하는 메소드를 만들자.  </p>\n<deckgo-highlight-code language=\"javascript\"  >\n          <code slot=\"code\">class Environments {\n  ...\n\n    static void setEnvironments(Environment env) {\n    _currentEnv = env;\n\n    switch (env) {\n      case Environment.DEV:\n        _config = _Config.debugConstants;\n        break;\n      case Environment.PROD:\n        _config = _Config.productConstants;\n        break;\n      case Environment.STAGING:\n        _config = _Config.stagingConstants;\n        break;\n      default:\n        _config = _Config.debugConstants;\n        break;\n    }\n  }\n\n}</code>\n        </deckgo-highlight-code>\n<p>위 메소드는 환경변수를 받아 _config 에 우리가 만든 환경변수 값을 넣는다.<br>\n마지막으로 해당 값 들을 가져 올 getter 를 만들자.</p>\n<deckgo-highlight-code language=\"javascript\"  >\n          <code slot=\"code\">class Environments {\n  ...\n\n  static get authUrl =&gt; _config[_Config.AUTH_URL];\n  static get websocketUrl =&gt; _config[_Config.WEBSOCKET_URL];\n  static get productUrl =&gt; _config[_Config.PRODUCT_URL];\n  static get env =&gt; _currentEnv.toString();\n\n}</code>\n        </deckgo-highlight-code>\n<p>URL 이 추가되면 getter 도 같이 늘려주면 된다.<br>\n이걸로 필요한 클래스는 다 만들었다.<br>\n간단한 부분이라 딱히 더 설명 할 부분이 없다.  </p>\n<p>이제 마지막으로 해당 환경변수를 설정해서 사용해 보자.</p>\n<h3>Main Delegate</h3>\n<p>우리는 별도의 명령과 값을 주어 실행하지 않고<br>\n환경 별 실행 부분을 여러개로 쪼개서 만들 것 이다.  </p>\n<p>여러개로 쪼개서 만들게 되면 빌드 시 환경 별로 선택하기 쉬워지고,<br>\n더해서 vscode 에서는 환경 별 debug 가 쉬워진다.</p>\n<p>먼저 환경 App 을 구동시키는 main delegate 를 만들자.\n해당 delegate 에서는 앱 구동의 역활을 맡고, delegate 로 가기 전<br>\n환경 변수를 설정 할 것 이다.  </p>\n<blockquote>\n<p><code class=\"language-text\">/lib/main_delegate.dart</code></p>\n</blockquote>\n<deckgo-highlight-code language=\"javascript\"  >\n          <code slot=\"code\">  import &#39;package:flutter/material.dart&#39;;\n\n  void mainDelegate() =&gt; runApp(MyApp());\n\n  class MyApp extends StatelessWidget {\n  const MyApp({Key key}) : super(key: key);\n\n  @override\n  Widget build(BuildContext context) {\n    return MaterialApp(\n      theme: ThemeData.dark(),\n      home: Scaffold(\n        appBar: AppBar(\n          title: Text(&#39;Flutter Environments&#39;),\n        ),\n        body: Container(\n          child: Text(&#39;env&#39;),\n        ),\n      ),\n    );\n  }\n}</code>\n        </deckgo-highlight-code>\n<p>간단하게 main 부분을 만들었다.<br>\n여기서 현재 환경 변수 값을 표시 할 수 있도록 위젯을 추가해보자.  </p>\n<deckgo-highlight-code language=\"javascript\"  >\n          <code slot=\"code\">  ...\n\n  class _BuildText extends StatelessWidget {\n    const _BuildText({\n      Key key,\n      this.text,\n    }) : super(key: key);\n    final String text;\n\n    @override\n    Widget build(BuildContext context) {\n      return Container(\n        margin: EdgeInsets.only(\n          bottom: 10.0,\n        ),\n        child: Text(\n          text,\n          style: TextStyle(\n            fontSize: 16.0,\n          ),\n        ),\n      );\n    }\n}</code>\n        </deckgo-highlight-code>\n<p>이제 위젯에 설정한 환경변수 값을 넣어보자.  </p>\n<deckgo-highlight-code language=\"javascript\"  >\n          <code slot=\"code\">  ...\n  class MyApp extends StatelessWidget {\n    ...\n    body: Container(\n      width: double.infinity,\n      child: Column(\n        mainAxisAlignment: MainAxisAlignment.center,\n        children: [\n          _BuildText(\n            text: &#39;ENV : ${Environments.env}&#39;,\n          ),\n          _BuildText(\n            text: &#39;AUTH_URL: ${Environments.authUrl}&#39;,\n          ),\n          _BuildText(\n            text: &#39;PRODUCT_URL: ${Environments.productUrl}&#39;,\n          ),\n          _BuildText(\n            text: &#39;WEBSOCKET_URL: ${Environments.websocketUrl}&#39;,\n          )\n        ],\n      ),\n    ),\n  }</code>\n        </deckgo-highlight-code>\n<p>준비가 다 되었다.<br>\n이제 실행 파일을 만들어보자.  </p>\n<blockquote>\n<p><code class=\"language-text\">/lib/main_staging.dart</code></p>\n</blockquote>\n<deckgo-highlight-code language=\"javascript\"  >\n          <code slot=\"code\">import &#39;package:env_setting/core/env.dart&#39;;\nimport &#39;main_delegate.dart&#39;;\n\nvoid main() {\n  Environments.setEnvironments(Environment.STAGING);\n  mainDelegate();\n}</code>\n        </deckgo-highlight-code>\n<p>Staging 환경의 실행 파일을 만들었다.<br>\n이제 main 을 실행 해보면 Staging 환경 변수의 값을 볼 수 있다.  </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 335px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d3c810254c3730a0fb3f8e49e4fe9a57/c0051/env_staging.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 203.3783783783784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAApCAYAAAA1bQl+AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB7UlEQVRIx+2V2W7qQAyG8xyAGhCLKhD7WvZ930Hi/Z/Eh89HjpKUHh2pXFQVF788tsf/eDyJ7cTjcUkkEmISRKNRiUQiKmOxWECaD133E3eHe19f3t/FMRI/ptOpLBYLGQ6H0u/3ZTKZqByPx2qbzWbS6/UCScTvcN/exMHoh+u60mq1NBiSWq2mstPpqIRoNBqpHo4FTjablTDS6bQkk0lJpVKSyWRUYkMCfOiPYp1SqSRhlMtlqVQqCtZhmP1RrFMsFuWZeD7ho7S/gxfhi/D3E/LrfLXxK1/Y7pjRHMhCoRD4P/3B+Az+GFs74VNoTY1GQ6rVqsLfpvA1m031A/Rwpt6VOZEG+dH6kMvlot15s9nIbreT/X4v5/NZlsul6qyv16seSAyxgX6Yy+W0ta/Xa50fEDE7mCvz+VyJwGq10vbPTGHNfuYP4yCfz/9tX6Td7XY1mCCkERJAoAUbAfp2u1XJgcRTCsrjkPbxeJTD4aAbjIhM7IrYOQQ72SGxQ4odiY3ktIbUgSvfbjetDQdQN7KhXhxyOp28A/BBwm3QB4OBli3wKIxLatFut3WM2mui1+t1zwe4ou1jjd97ZVvwUhTWYN+arf2+MOyVvZnyrz/kf/HpO3y1rxfhryL0t/EfQ+jneP6//OwM/wB5Tw8d4p+vwQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"env-staging\"\n        title=\"env-staging\"\n        src=\"/static/d3c810254c3730a0fb3f8e49e4fe9a57/c0051/env_staging.png\"\n        srcset=\"/static/d3c810254c3730a0fb3f8e49e4fe9a57/12f09/env_staging.png 148w,\n/static/d3c810254c3730a0fb3f8e49e4fe9a57/e4a3f/env_staging.png 295w,\n/static/d3c810254c3730a0fb3f8e49e4fe9a57/c0051/env_staging.png 335w\"\n        sizes=\"(max-width: 335px) 100vw, 335px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>다른 환경 파일 역시 main<em>prod.dart 또는 main</em>dev.dart 를 만들어<br>\nEnvironment 값만 변경 시키면 된다.  </p>\n<p>이렇게 해두면 빌드 시 메인 파일 타겟을 횐경 별로 지정해서 원하는 환경의 앱을<br>\n손쉽게(?) 빌드 할 수 있다.</p>\n<p>위 예제의 전체 코드</p>\n<p>Github: <a href=\"https://github.com/WillowRyu/flutter-env-setting\" target=\"_blank\">https://github.com/WillowRyu/flutter-env-setting</a>  </p>\n<p>출처: 내 머리 &#x26; 기억나지 않는 어떤 개발자의 글</p>","frontmatter":{"title":"Flutter Environments Setting","date":"August 11, 2020","description":"Flutter 에서 환경변수 설정"}}},"pageContext":{"slug":"/2020-08-11/","previous":{"fields":{"slug":"/2020-07-03/"},"frontmatter":{"title":"Flutter Cupertino Date Picker"}},"next":{"fields":{"slug":"/2021-01-03/"},"frontmatter":{"title":"react web 클린하게 시작하기"}}}},"staticQueryHashes":["2841359383","3490846071"]}